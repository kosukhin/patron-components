{"version":3,"file":"patron-components.mjs","sources":["../src/route/Route.ts","../src/index.ts"],"sourcesContent":["import {give, GuestChain, GuestType, Patron, Source} from \"patron-oop\";\nimport {HistoryCurrentPage, HistoryNewPage, HistoryPageDocument} from \"patron-web-api\";\n\nexport interface RouteDocument {\n    url: string,\n    template: string,\n    page: {\n        mounted: () => void\n    },\n    default?: boolean,\n}\n\nexport class Route {\n    public constructor(\n        private basePath: Source<string>,\n        private currentPage: HistoryCurrentPage,\n        private newPage: HistoryNewPage\n    ) {}\n\n    public page(url: string) {\n        this.basePath.receiving(\n            (basePath) => {\n                this.newPage.receive({\n                    url: `${basePath}${url}`,\n                    title: 'Идет загрузка',\n                    data: {\n                        url: `${basePath}${url}`,\n                        date: new Date().getTime(),\n                    },\n                } as any);\n            },\n        );\n    }\n\n    public handleRoutes(\n        displaySelector: string,\n        routes: RouteDocument[],\n    ) {\n        const contentEl = document.querySelector(displaySelector);\n        const defaultRoute = routes.find(route => route.default);\n        this.firstLoad(\n            () => {\n                this.currentPage.page(new Patron((value) => {\n                    this.basePath.receiving(\n                        (basePath) => {\n                            basePath = basePath.replace('/#', '');\n                            let currentUrl = value.url === '/' ? basePath + '/' : value.url;\n                            currentUrl = currentUrl.replace('#', '').replace('//', '/');\n                            let route = routes.find(route => basePath + route.url === currentUrl);\n\n                            if (!route && defaultRoute) {\n                                route = defaultRoute;\n                            }\n\n                            if (route) {\n                                fetch(basePath + '/' + route.template).then(result => result.text()).then(template => {\n                                    if (contentEl) {\n                                        contentEl.innerHTML = template;\n                                    }\n                                    route.page?.mounted();\n                                });\n                            }\n                        },\n                    );\n                }));\n            },\n        );\n    }\n\n    private firstLoad(guest: GuestType) {\n        const chain = new GuestChain<any>();\n        this.basePath.receiving(chain.receiveKey('basePath'));\n        this.currentPage.page(chain.receiveKey('currentPage'));\n        chain.result(\n            ({basePath, currentPage}) => {\n                const correctUrl = location.href.replace(location.origin, '');\n\n                if (currentPage.url !== correctUrl) {\n                    this.page(correctUrl.replace(basePath, ''));\n                    setTimeout(() => {\n                        give(null, guest);\n                    });\n                }\n            },\n        );\n    }\n}\n","import {Route} from \"./route/Route\";\n\nexport * from './route/Route';\n\ndeclare var globalThis: any;\n\nif (globalThis) {\n    if (!globalThis[\"GUEST_LIBRARY\"]) {\n        globalThis[\"GUEST_LIBRARY\"] = {};\n    }\n\n    globalThis[\"GUEST_LIBRARY\"]['components'] = {\n        Route,\n    }\n}\n"],"names":["route"],"mappings":"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"}