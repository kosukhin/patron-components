!function(e,t,r,s,n,o,i,a){"use strict";var l=Object.defineProperty,c=(e,t,r)=>((e,t,r)=>t in e?l(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,t+"",r);e.ComputedElement=class{constructor(e,t){this.sources=e,this.selectorTemplate=t}element(e){const r=new t.SourceAll;this.sources.forEach((s=>{s.source.value(new t.GuestCast(e,r.guestKey(s.placeholder)))})),r.value(new t.GuestCast(e,(r=>{let s=this.selectorTemplate;Object.entries(r).map((e=>{s=s.replaceAll(e[0],e[1])}));const n=document.querySelector(s);n&&t.give(n,e)})))}},e.CurrentPage=class{constructor(){c(this,"source");const e=location.href.replace(location.origin,"");this.source=new t.SourceWithPool(e)}give(e){return this.source.give(e),this}value(e){return this.source.value(e),e}pool(){return this.source.pool()}},e.EntryPointPage=class{constructor(e,t){this.title=e,this.entryPointUrl=t}mounted(){document.title=this.title,import(this.entryPointUrl).then((e=>{e.main&&e.main()}))}},e.GroupActiveClass=class{constructor(e,t,r){this.activeClass=e,this.groupSelector=t,this.document=r}give(e){return t.value(this.document,new t.PatronOnce((t=>{t.querySelectorAll(this.groupSelector).forEach((e=>{e.classList.remove(this.activeClass)})),e.classList.add(this.activeClass)}))),this}},e.Input=class{constructor(e,r){this.source=e;const s=document.querySelector(r);this.source.value(new t.Patron((e=>{s.value=String(e)}))),s.addEventListener("keyup",(()=>{this.give(s.value)})),s.addEventListener("change",(()=>{this.give(s.value)}))}value(e){return this.source.value(e),this}give(e){return this.source.give(e),this}pool(){return this.source.pool()}},e.Link=class{constructor(e,t){this.linkSource=e,this.basePath=t}watchClick(e,t){const r=document.querySelectorAll(e);if(!r.length)throw new Error(`Link wrapper not found for selector ${e}`);r.forEach((e=>{e.addEventListener("click",(r=>{t?e.querySelectorAll(t).forEach((e=>{r?.target!==e&&r?.currentTarget!==e||this.handleClick({preventDefault:r.preventDefault.bind(r),target:e})})):this.handleClick(r)}))}))}handleClick(e){let r=e?.target?.getAttribute("href");r||(r=e?.currentTarget?.getAttribute("href")),r&&0!==r.indexOf("http")&&(e.preventDefault(),t.value(this.basePath,(e=>{this.linkSource.give(e+r)})))}},e.Navigation=class{constructor(e,t,r,s,n){this.loading=e,this.basePath=t,this.currentPage=r,this.display=s,this.pageTransport=n}routes(e){const r=e.find((e=>e.default)),s=new t.SourceAll;t.value(this.basePath,new t.Patron(s.guestKey("basePath"))),t.value(this.currentPage,new t.Patron(s.guestKey("currentPage"))),s.value(new t.Patron((({basePath:s,currentPage:n})=>{const o=n.replace(s,""),i=e.find((e=>e.aliases&&(e.aliases.includes(n)||e.aliases.includes(o))));if(i){const e=s+i.url;if(e!==n)return void t.give(e,this.currentPage)}let a=e.find((e=>{if(e.url.indexOf("*")>=0){return new RegExp(e.url.replaceAll("*",".*").replaceAll("/","/")).test(o)}return e.url.replaceAll("*","")===o}));if(!a&&r&&(a=r),!a)throw new Error("No matching route in Navigation");{const e=s.replace("/#","").replace("#","").replace(/[^/]+\.html$/,"");t.give(!0,this.loading),this.pageTransport.get(e,a.template).content((e=>{this.display.display(e),a.page.mounted(),t.give(!1,this.loading)}))}})))}},e.Page=class{constructor(e){this.title=e}mounted(){document.title=this.title}},e.PageFetchTransport=class{constructor(e,t){this.basePath=e,this.template=t}content(e){fetch(this.basePath+"/"+this.template).then((e=>e.text())).then((r=>{t.give(r,e)}))}},e.RouteDisplay=class{constructor(e){this.selector=e}display(e){const t=document.querySelector(this.selector);t&&(t.innerHTML=e)}},e.Router=class{constructor(e,t,r){this.loaderSelector=e,this.navigationResultSelector=t,this.menuSelector=r}routes(e,l,c,u){l||(l=new n.CurrentPage),l.value(new t.Patron(new r.HistoryNewPage));const[h]=location.href.replace(location.origin,"").split("#");c||(c=new t.SourceWithPool(`${h}#`.replace("index.html","").replace("//","/")));const p=new t.SourceWithPool(!1);p.value(new t.Patron(new s.Visible(this.loaderSelector)));new r.HistoryPoppedPage(l).watchPop();new o.Navigation(p,c,l,new a.RouteDisplay(this.navigationResultSelector),new t.PrivateClass(i.PageFetchTransport)).routes(e);new s.Link(l,c).watchClick(this.menuSelector);const g=new t.SourceAll;c.value(new t.Patron(g.guestKey("basePath"))),l.value(new t.Patron(g.guestKey("page")));const d=new t.Source((e=>{g.value(new t.GuestCast(e,(({basePath:r,page:s})=>{t.give(s.replace(r,""),e)})))}));new s.ComputedElement([{source:d,placeholder:"{url}"}],`${this.menuSelector} a[href="{url}"]`).element(new t.Patron(new s.GroupActiveClass("active",`${this.menuSelector} a`,t.sourceOf(document)))),p.value(new t.Patron((e=>{if(e)return;u&&u();const t=document.querySelector(this.navigationResultSelector);t&&t.querySelectorAll("script").forEach((e=>{const r=document.createElement("script");r.setAttribute("type","module"),r.appendChild(document.createTextNode(e.innerText)),t.appendChild(r)}))})))}},e.Text=class{constructor(e){this.selector=e}give(e){const t=document.querySelector(this.selector);return t&&(t.innerText=String(e)),this}},e.Visible=class{constructor(e){this.selector=e}give(e){const t=document.querySelector(this.selector);return t&&(t.style.display=e?"block":"none"),this}}}({},patronOop,patronWebApi,controls,CurrentPage$1,Navigation$1,PageFetchTransport$1,RouteDisplay$1);
